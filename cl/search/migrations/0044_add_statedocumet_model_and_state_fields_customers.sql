BEGIN;
--
-- Create model StateDocument
--
CREATE TABLE "search_statedocument" ("id" integer NOT NULL PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY, "date_created" timestamp with time zone NOT NULL, "date_modified" timestamp with time zone NOT NULL, "sha1" varchar(40) NOT NULL, "page_count" integer NULL, "file_size" integer NULL, "filepath_local" varchar(1000) NOT NULL, "filepath_ia" varchar(1000) NOT NULL, "ia_upload_failure_count" smallint NULL, "thumbnail" varchar(100) NULL, "thumbnail_status" smallint NOT NULL, "plain_text" text NOT NULL, "ocr_status" smallint NULL, "document_number" integer NOT NULL, "document_name" varchar(100) NOT NULL, "description" varchar(100) NOT NULL, "filed_by_str" varchar(100) NOT NULL, "filed_status" varchar(100) NOT NULL, "confirmation_notice_url" varchar(200) NOT NULL, "document_source_url" varchar(200) NOT NULL, "date_filed" timestamp with time zone NULL, "date_received" timestamp with time zone NULL);
--
-- Add field state to court
--
ALTER TABLE "search_court" ADD COLUMN "state" varchar(2) DEFAULT '' NOT NULL;
ALTER TABLE "search_court" ALTER COLUMN "state" DROP DEFAULT;
--
-- Add field case_source_url to docket
--
ALTER TABLE "search_docket" ADD COLUMN "case_source_url" varchar(500) NULL;
--
-- Add field case_status to docket
--
ALTER TABLE "search_docket" ADD COLUMN "case_status" varchar(100) DEFAULT '' NOT NULL;
ALTER TABLE "search_docket" ALTER COLUMN "case_status" DROP DEFAULT;
--
-- Add field efile_status to docket
--
ALTER TABLE "search_docket" ADD COLUMN "efile_status" varchar(100) DEFAULT '' NOT NULL;
ALTER TABLE "search_docket" ALTER COLUMN "efile_status" DROP DEFAULT;
--
-- Add field docket to statedocument
--
ALTER TABLE "search_statedocument" ADD COLUMN "docket_id" integer NOT NULL CONSTRAINT "search_statedocument_docket_id_11bb6077_fk_search_docket_id" REFERENCES "search_docket"("id") DEFERRABLE INITIALLY DEFERRED; SET CONSTRAINTS "search_statedocument_docket_id_11bb6077_fk_search_docket_id" IMMEDIATE;
--
-- Add field filed_by to statedocument
--
ALTER TABLE "search_statedocument" ADD COLUMN "filed_by_id" integer NULL CONSTRAINT "search_statedocument_filed_by_id_2f10c62f_fk_people_db" REFERENCES "people_db_person"("id") DEFERRABLE INITIALLY DEFERRED; SET CONSTRAINTS "search_statedocument_filed_by_id_2f10c62f_fk_people_db" IMMEDIATE;
--
-- Add field tags to statedocument
--
CREATE TABLE "search_statedocument_tags" ("id" integer NOT NULL PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY, "statedocument_id" integer NOT NULL, "tag_id" integer NOT NULL);
--
-- Alter unique_together for statedocument (1 constraint(s))
--
ALTER TABLE "search_statedocument" ADD CONSTRAINT "search_statedocument_docket_id_document_number_a3779e19_uniq" UNIQUE ("docket_id", "document_number");
--        
CREATE INDEX "search_statedocument_date_created_e038a8f9" ON "search_statedocument" ("date_created");
CREATE INDEX "search_statedocument_date_modified_5008c846" ON "search_statedocument" ("date_modified");
CREATE INDEX "search_statedocument_docket_id_11bb6077" ON "search_statedocument" ("docket_id");
CREATE INDEX "search_statedocument_filed_by_id_2f10c62f" ON "search_statedocument" ("filed_by_id");
ALTER TABLE "search_statedocument_tags" ADD CONSTRAINT "search_statedocument_tags_statedocument_id_tag_id_cf895b23_uniq" UNIQUE ("statedocument_id", "tag_id");
ALTER TABLE "search_statedocument_tags" ADD CONSTRAINT "search_statedocument_statedocument_id_c0ca953c_fk_search_st" FOREIGN KEY ("statedocument_id") REFERENCES "search_statedocument" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "search_statedocument_tags" ADD CONSTRAINT "search_statedocument_tags_tag_id_11b00235_fk_search_tag_id" FOREIGN KEY ("tag_id") REFERENCES "search_tag" ("id") DEFERRABLE INITIALLY DEFERRED;
CREATE INDEX "search_statedocument_tags_statedocument_id_c0ca953c" ON "search_statedocument_tags" ("statedocument_id");
CREATE INDEX "search_statedocument_tags_tag_id_11b00235" ON "search_statedocument_tags" ("tag_id");
COMMIT;
