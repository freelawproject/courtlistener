# Generated by Django 3.2.16 on 2023-01-26 00:25

import cl.lib.model_helpers
import cl.lib.storage
from django.db import migrations, models
import django.db.models.deletion
import pgtrigger.compiler
import pgtrigger.migrations


class Migration(migrations.Migration):

    dependencies = [
        ('pghistory', '0005_events_middlewareevents'),
        ('search', '0011_add_event_tables_and_triggers'),
        ('people_db', '0014_add_event_tables_and_triggers'),
        ('audio', '0001_initial'),
    ]

    operations = [
        migrations.CreateModel(
            name='AudioEvent',
            fields=[
                ('pgh_id', models.AutoField(primary_key=True, serialize=False)),
                ('pgh_created_at', models.DateTimeField(auto_now_add=True)),
                ('pgh_label', models.TextField(help_text='The event label.')),
                ('id', models.IntegerField()),
                ('date_created', models.DateTimeField(auto_now_add=True, help_text='The moment when the item was created.')),
                ('date_modified', models.DateTimeField(auto_now=True, help_text='The last moment when the item was modified. A value in year 1750 indicates the value is unknown')),
                ('source', models.CharField(blank=True, choices=[('C', 'court website'), ('R', 'public.resource.org'), ('CR', 'court website merged with resource.org'), ('L', 'lawbox'), ('LC', 'lawbox merged with court'), ('LR', 'lawbox merged with resource.org'), ('LCR', 'lawbox merged with court and resource.org'), ('M', 'manual input'), ('A', 'internet archive'), ('H', 'brad heath archive'), ('Z', 'columbia archive'), ('ZC', 'columbia merged with court'), ('ZLC', 'columbia merged with lawbox and court'), ('ZLR', 'columbia merged with lawbox and resource.org'), ('ZLCR', 'columbia merged with lawbox, court, and resource.org'), ('ZR', 'columbia merged with resource.org'), ('ZCR', 'columbia merged with court and resource.org'), ('ZL', 'columbia merged with lawbox'), ('U', 'Harvard, Library Innovation Lab Case Law Access Project'), ('CU', 'court website merged with Harvard'), ('D', 'direct court input')], help_text='the source of the audio file, one of: C (court website), R (public.resource.org), CR (court website merged with resource.org), L (lawbox), LC (lawbox merged with court), LR (lawbox merged with resource.org), LCR (lawbox merged with court and resource.org), M (manual input), A (internet archive), H (brad heath archive), Z (columbia archive), ZC (columbia merged with court), ZLC (columbia merged with lawbox and court), ZLR (columbia merged with lawbox and resource.org), ZLCR (columbia merged with lawbox, court, and resource.org), ZR (columbia merged with resource.org), ZCR (columbia merged with court and resource.org), ZL (columbia merged with lawbox), U (Harvard, Library Innovation Lab Case Law Access Project), CU (court website merged with Harvard), D (direct court input)', max_length=10)),
                ('case_name_short', models.TextField(blank=True, help_text="The abridged name of the case, often a single word, e.g. 'Marsh'")),
                ('case_name', models.TextField(blank=True, help_text='The full name of the case')),
                ('case_name_full', models.TextField(blank=True, help_text='The full name of the case')),
                ('judges', models.TextField(blank=True, help_text='The judges that heard the oral arguments as a simple text string. This field is used when normalized judges cannot be placed into the panel field.', null=True)),
                ('sha1', models.CharField(help_text='unique ID for the document, as generated via SHA1 of the binary file or text data', max_length=40)),
                ('download_url', models.URLField(blank=True, help_text='The URL on the court website where the document was originally scraped', max_length=500, null=True)),
                ('local_path_mp3', models.FileField(blank=True, help_text='The location in AWS S3 where our enhanced copy of the original audio file is stored. Note that the field name is historical, from before when we used S3. To find the location in S3, concatenate https://storage.courtlistener.com/ and the value of this field.', storage=cl.lib.storage.IncrementingAWSMediaStorage(), upload_to=cl.lib.model_helpers.make_upload_path)),
                ('local_path_original_file', models.FileField(help_text='The location in AWS S3 where the original audio file downloaded from the court is stored. Note that the field name is historical, from before when we used S3. To find the location in S3, concatenate https://storage.courtlistener.com/ and the value of this field.', storage=cl.lib.storage.IncrementingAWSMediaStorage(), upload_to=cl.lib.model_helpers.make_upload_path)),
                ('filepath_ia', models.CharField(blank=True, help_text='The URL of the file in IA', max_length=1000)),
                ('ia_upload_failure_count', models.SmallIntegerField(blank=True, help_text='Number of times the upload to the Internet Archive failed.', null=True)),
                ('duration', models.SmallIntegerField(help_text='the length of the item, in seconds', null=True)),
                ('processing_complete', models.BooleanField(default=False, help_text='Is audio for this item done processing?')),
                ('date_blocked', models.DateField(blank=True, help_text='The date that this opinion was blocked from indexing by search engines', null=True)),
                ('blocked', models.BooleanField(default=False, help_text='Should this item be blocked from indexing by search engines?')),
                ('stt_status', models.SmallIntegerField(choices=[(0, 'Speech to Text Needed'), (1, 'Speech to Text Complete'), (2, 'Speech to Text Failed')], default=0, help_text='The status of the Speech to Text for this item?', verbose_name='Speech to text status')),
                ('stt_google_response', models.TextField(blank=True, help_text='The JSON response object returned by Google Speech.', verbose_name='Speech to text Google response')),
            ],
            options={
                'abstract': False,
            },
        ),
        migrations.CreateModel(
            name='AudioPanelEvent',
            fields=[
                ('pgh_id', models.AutoField(primary_key=True, serialize=False)),
                ('pgh_created_at', models.DateTimeField(auto_now_add=True)),
                ('pgh_label', models.TextField(help_text='The event label.')),
                ('id', models.IntegerField()),
            ],
            options={
                'abstract': False,
            },
        ),
        migrations.CreateModel(
            name='AudioPanel',
            fields=[
            ],
            options={
                'proxy': True,
                'indexes': [],
                'constraints': [],
            },
            bases=('audio.audio_panel',),
        ),
        pgtrigger.migrations.AddTrigger(
            model_name='audio',
            trigger=pgtrigger.compiler.Trigger(name='snapshot_insert', sql=pgtrigger.compiler.UpsertTriggerSql(func='INSERT INTO "audio_audioevent" ("blocked", "case_name", "case_name_full", "case_name_short", "date_blocked", "date_created", "date_modified", "docket_id", "download_url", "duration", "filepath_ia", "ia_upload_failure_count", "id", "judges", "local_path_mp3", "local_path_original_file", "pgh_context_id", "pgh_created_at", "pgh_label", "pgh_obj_id", "processing_complete", "sha1", "source", "stt_google_response", "stt_status") VALUES (NEW."blocked", NEW."case_name", NEW."case_name_full", NEW."case_name_short", NEW."date_blocked", NEW."date_created", NEW."date_modified", NEW."docket_id", NEW."download_url", NEW."duration", NEW."filepath_ia", NEW."ia_upload_failure_count", NEW."id", NEW."judges", NEW."local_path_mp3", NEW."local_path_original_file", _pgh_attach_context(), NOW(), \'snapshot\', NEW."id", NEW."processing_complete", NEW."sha1", NEW."source", NEW."stt_google_response", NEW."stt_status"); RETURN NULL;', hash='5fb8248949cbe5b6e4330bc7503bdfdbe7bd2d14', operation='INSERT', pgid='pgtrigger_snapshot_insert_43674', table='audio_audio', when='AFTER')),
        ),
        pgtrigger.migrations.AddTrigger(
            model_name='audio',
            trigger=pgtrigger.compiler.Trigger(name='snapshot_update', sql=pgtrigger.compiler.UpsertTriggerSql(condition='WHEN (OLD.* IS DISTINCT FROM NEW.*)', func='INSERT INTO "audio_audioevent" ("blocked", "case_name", "case_name_full", "case_name_short", "date_blocked", "date_created", "date_modified", "docket_id", "download_url", "duration", "filepath_ia", "ia_upload_failure_count", "id", "judges", "local_path_mp3", "local_path_original_file", "pgh_context_id", "pgh_created_at", "pgh_label", "pgh_obj_id", "processing_complete", "sha1", "source", "stt_google_response", "stt_status") VALUES (NEW."blocked", NEW."case_name", NEW."case_name_full", NEW."case_name_short", NEW."date_blocked", NEW."date_created", NEW."date_modified", NEW."docket_id", NEW."download_url", NEW."duration", NEW."filepath_ia", NEW."ia_upload_failure_count", NEW."id", NEW."judges", NEW."local_path_mp3", NEW."local_path_original_file", _pgh_attach_context(), NOW(), \'snapshot\', NEW."id", NEW."processing_complete", NEW."sha1", NEW."source", NEW."stt_google_response", NEW."stt_status"); RETURN NULL;', hash='de7e7fe34af4612d2d3e775f3c57bbc5b7fdebb7', operation='UPDATE', pgid='pgtrigger_snapshot_update_c0234', table='audio_audio', when='AFTER')),
        ),
        migrations.AddField(
            model_name='audiopanelevent',
            name='audio',
            field=models.ForeignKey(db_constraint=False, db_tablespace='', on_delete=django.db.models.deletion.DO_NOTHING, related_name='+', related_query_name='+', to='audio.audio'),
        ),
        migrations.AddField(
            model_name='audiopanelevent',
            name='person',
            field=models.ForeignKey(db_constraint=False, db_tablespace='', on_delete=django.db.models.deletion.DO_NOTHING, related_name='+', related_query_name='+', to='people_db.person'),
        ),
        migrations.AddField(
            model_name='audiopanelevent',
            name='pgh_context',
            field=models.ForeignKey(db_constraint=False, null=True, on_delete=django.db.models.deletion.DO_NOTHING, related_name='+', to='pghistory.context'),
        ),
        migrations.AddField(
            model_name='audioevent',
            name='docket',
            field=models.ForeignKey(blank=True, db_constraint=False, help_text='The docket that the oral argument is a part of', null=True, on_delete=django.db.models.deletion.DO_NOTHING, related_name='+', related_query_name='+', to='search.docket'),
        ),
        migrations.AddField(
            model_name='audioevent',
            name='pgh_context',
            field=models.ForeignKey(db_constraint=False, null=True, on_delete=django.db.models.deletion.DO_NOTHING, related_name='+', to='pghistory.context'),
        ),
        migrations.AddField(
            model_name='audioevent',
            name='pgh_obj',
            field=models.ForeignKey(db_constraint=False, on_delete=django.db.models.deletion.DO_NOTHING, related_name='event', to='audio.audio'),
        ),
        pgtrigger.migrations.AddTrigger(
            model_name='audiopanel',
            trigger=pgtrigger.compiler.Trigger(name='snapshot_insert', sql=pgtrigger.compiler.UpsertTriggerSql(func='INSERT INTO "audio_audiopanelevent" ("audio_id", "id", "person_id", "pgh_context_id", "pgh_created_at", "pgh_label") VALUES (NEW."audio_id", NEW."id", NEW."person_id", _pgh_attach_context(), NOW(), \'snapshot\'); RETURN NULL;', hash='e069d7d8bfc5654b553214f657719fa0772a8e4d', operation='INSERT', pgid='pgtrigger_snapshot_insert_0141b', table='audio_audio_panel', when='AFTER')),
        ),
        pgtrigger.migrations.AddTrigger(
            model_name='audiopanel',
            trigger=pgtrigger.compiler.Trigger(name='snapshot_update', sql=pgtrigger.compiler.UpsertTriggerSql(condition='WHEN (OLD.* IS DISTINCT FROM NEW.*)', func='INSERT INTO "audio_audiopanelevent" ("audio_id", "id", "person_id", "pgh_context_id", "pgh_created_at", "pgh_label") VALUES (NEW."audio_id", NEW."id", NEW."person_id", _pgh_attach_context(), NOW(), \'snapshot\'); RETURN NULL;', hash='515a9726c66bdf5232725f4a4a00761cafbbc7af', operation='UPDATE', pgid='pgtrigger_snapshot_update_17291', table='audio_audio_panel', when='AFTER')),
        ),
    ]
