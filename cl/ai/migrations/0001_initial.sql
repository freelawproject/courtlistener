BEGIN;
--
-- Create model Prompt
--
CREATE TABLE "ai_prompt" ("id" integer NOT NULL PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY, "date_created" timestamp with time zone NOT NULL, "date_modified" timestamp with time zone NOT NULL, "name" varchar(255) NOT NULL, "prompt_type" smallint NOT NULL, "text" text NOT NULL, "notes" text NOT NULL, "is_active" boolean NOT NULL);
--
-- Create model LLMRequest
--
CREATE TABLE "ai_llmrequest" ("id" integer NOT NULL PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY, "date_created" timestamp with time zone NOT NULL, "date_modified" timestamp with time zone NOT NULL, "name" varchar(255) NOT NULL, "is_batch" boolean NOT NULL, "batch_id" varchar(255) NOT NULL, "provider" smallint NOT NULL, "api_model_name" varchar(100) NOT NULL, "status" smallint NOT NULL, "total_tasks" integer NOT NULL, "completed_tasks" integer NOT NULL, "failed_tasks" integer NOT NULL, "max_retries" smallint NOT NULL, "total_cost_estimate" numeric(10, 4) NULL, "total_cost_actual" numeric(10, 4) NULL, "date_started" timestamp with time zone NULL, "date_completed" timestamp with time zone NULL, "extra_config_params" jsonb NULL, "batch_response_file" varchar(1000) NOT NULL);
CREATE TABLE "ai_llmrequest_prompts" ("id" integer NOT NULL PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY, "llmrequest_id" integer NOT NULL, "prompt_id" integer NOT NULL);
--
-- Create model LLMTask
--
CREATE TABLE "ai_llmtask" ("id" integer NOT NULL PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY, "date_created" timestamp with time zone NOT NULL, "date_modified" timestamp with time zone NOT NULL, "status" smallint NOT NULL, "llm_key" varchar(255) NOT NULL, "task" smallint NOT NULL, "retry_count" smallint NOT NULL, "error_message" text NOT NULL, "input_file" varchar(1000) NOT NULL, "response_file" varchar(1000) NOT NULL, "processing_time_ms" integer NULL, "date_started" timestamp with time zone NULL, "date_completed" timestamp with time zone NULL, "object_id" integer NULL CHECK ("object_id" >= 0), "content_type_id" integer NULL, "request_id" integer NULL);
CREATE INDEX "ai_prompt_date_created_b5722513" ON "ai_prompt" ("date_created");
CREATE INDEX "ai_prompt_date_modified_3928cd71" ON "ai_prompt" ("date_modified");
CREATE INDEX "ai_llmrequest_date_created_1a7649fc" ON "ai_llmrequest" ("date_created");
CREATE INDEX "ai_llmrequest_date_modified_86522be5" ON "ai_llmrequest" ("date_modified");
ALTER TABLE "ai_llmrequest_prompts" ADD CONSTRAINT "ai_llmrequest_prompts_llmrequest_id_prompt_id_ec459ca0_uniq" UNIQUE ("llmrequest_id", "prompt_id");
ALTER TABLE "ai_llmrequest_prompts" ADD CONSTRAINT "ai_llmrequest_prompt_llmrequest_id_2221e73e_fk_ai_llmreq" FOREIGN KEY ("llmrequest_id") REFERENCES "ai_llmrequest" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "ai_llmrequest_prompts" ADD CONSTRAINT "ai_llmrequest_prompts_prompt_id_62f3058d_fk_ai_prompt_id" FOREIGN KEY ("prompt_id") REFERENCES "ai_prompt" ("id") DEFERRABLE INITIALLY DEFERRED;
CREATE INDEX "ai_llmrequest_prompts_llmrequest_id_2221e73e" ON "ai_llmrequest_prompts" ("llmrequest_id");
CREATE INDEX "ai_llmrequest_prompts_prompt_id_62f3058d" ON "ai_llmrequest_prompts" ("prompt_id");
ALTER TABLE "ai_llmtask" ADD CONSTRAINT "ai_llmtask_content_type_id_8d14a327_fk_django_content_type_id" FOREIGN KEY ("content_type_id") REFERENCES "django_content_type" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "ai_llmtask" ADD CONSTRAINT "ai_llmtask_request_id_80ee2b0f_fk_ai_llmrequest_id" FOREIGN KEY ("request_id") REFERENCES "ai_llmrequest" ("id") DEFERRABLE INITIALLY DEFERRED;
CREATE INDEX "ai_llmtask_date_created_1c75ad5f" ON "ai_llmtask" ("date_created");
CREATE INDEX "ai_llmtask_date_modified_d8083f72" ON "ai_llmtask" ("date_modified");
CREATE INDEX "ai_llmtask_content_type_id_8d14a327" ON "ai_llmtask" ("content_type_id");
CREATE INDEX "ai_llmtask_request_id_80ee2b0f" ON "ai_llmtask" ("request_id");
CREATE INDEX "ai_llmtask_content_49d7d1_idx" ON "ai_llmtask" ("content_type_id", "object_id");
COMMIT;